services:
  app-server:
    container_name: "${COMPOSE_PROJECT_NAME}_app-server"
    build: ./backend
    ports:
      - "3001:3001"
    volumes:
      - ./backend:/app:cached
      - rust-target:/app/target
      - cargo-registry:/usr/local/cargo/registry
    environment:
      - RUST_BACKTRACE=1
      - RUST_LOG=debug
    networks:
      - app-network
    command: bash -c "cargo build && cargo watch -x run"

  app-front:
    container_name: "${COMPOSE_PROJECT_NAME}_app-front"
    build: ./frontend
    ports:
      - "3000:3000"
    volumes:
      - ./frontend:/app:cached
      - node-modules:/app/node_modules
      - pnpm-store:/app/.pnpm-store
    environment:
      - NODE_ENV=development
      - DOCKER_ENV=true
    depends_on:
      - app-server
    networks:
      - app-network
    command: bash -c "pnpm install && pnpm dev"

networks:
  app-network:

volumes:
  rust-target:
  cargo-registry:
  node-modules:
  pnpm-store:
